<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Capistrano::SSH</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Capistrano::SSH</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/capistrano/ssh_rb.html">
                lib/capistrano/ssh.rb
                </a>
        <br />
                <a href="../../files/lib/capistrano/ssh_rb.html">
                lib/capistrano/ssh.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
A helper class for dealing with <a href="SSH.html">SSH</a> connections.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M001602">connect</a>&nbsp;&nbsp;
      <a href="#M001604">connect</a>&nbsp;&nbsp;
      <a href="#M001603">connection_strategy</a>&nbsp;&nbsp;
      <a href="#M001605">connection_strategy</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M001602" class="method-detail">
        <a name="M001602"></a>

        <div class="method-heading">
          <a href="#M001602" class="method-signature">
          <span class="method-name">connect</span><span class="method-args">(server, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
An abstraction to make it possible to <a
href="SSH.html#M001602">connect</a> to the server via public key without
prompting for the password. If the public key authentication fails this
will fall back to password authentication.
</p>
<p>
<tt>server</tt> must be an instance of <a
href="ServerDefinition.html">ServerDefinition</a>.
</p>
<p>
If a block is given, the new session is yielded to it, otherwise the new
session is returned.
</p>
<p>
If an :ssh_options key exists in <tt>options</tt>, it is passed to the
Net::SSH constructor. Values in <tt>options</tt> are then merged into it,
and any connection information in <tt>server</tt> is added last, so that
<tt>server</tt> info takes precedence over <tt>options</tt>, which takes
precendence over ssh_options.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001602-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001602-source">
<pre>
    <span class="ruby-comment cmt"># File lib/capistrano/ssh.rb, line 39</span>
39:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connect</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">options</span>={})
40:       <span class="ruby-identifier">connection_strategy</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">options</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">connection_options</span><span class="ruby-operator">|</span>
41:         <span class="ruby-identifier">connection</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">connection_options</span>)
42:         <span class="ruby-constant">Server</span>.<span class="ruby-identifier">apply_to</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">server</span>)
43:       <span class="ruby-keyword kw">end</span>
44:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001604" class="method-detail">
        <a name="M001604"></a>

        <div class="method-heading">
          <a href="#M001604" class="method-signature">
          <span class="method-name">connect</span><span class="method-args">(server, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
An abstraction to make it possible to <a
href="SSH.html#M001602">connect</a> to the server via public key without
prompting for the password. If the public key authentication fails this
will fall back to password authentication.
</p>
<p>
<tt>server</tt> must be an instance of <a
href="ServerDefinition.html">ServerDefinition</a>.
</p>
<p>
If a block is given, the new session is yielded to it, otherwise the new
session is returned.
</p>
<p>
If an :ssh_options key exists in <tt>options</tt>, it is passed to the
Net::SSH constructor. Values in <tt>options</tt> are then merged into it,
and any connection information in <tt>server</tt> is added last, so that
<tt>server</tt> info takes precedence over <tt>options</tt>, which takes
precendence over ssh_options.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001604-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001604-source">
<pre>
    <span class="ruby-comment cmt"># File lib/capistrano/ssh.rb, line 39</span>
39:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connect</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">options</span>={})
40:       <span class="ruby-identifier">connection_strategy</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">options</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">connection_options</span><span class="ruby-operator">|</span>
41:         <span class="ruby-identifier">connection</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">connection_options</span>)
42:         <span class="ruby-constant">Server</span>.<span class="ruby-identifier">apply_to</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">server</span>)
43:       <span class="ruby-keyword kw">end</span>
44:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001603" class="method-detail">
        <a name="M001603"></a>

        <div class="method-heading">
          <a href="#M001603" class="method-signature">
          <span class="method-name">connection_strategy</span><span class="method-args">(server, options={}) {|server.host, user, connection_options| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Abstracts the logic for establishing an <a href="SSH.html">SSH</a>
connection (which includes testing for connection failures and retrying
with a password, and so forth, mostly made complicated because of the fact
that some of these variables might be lazily evaluated and try to do
something like prompt the user, which should only happen when absolutely
necessary.
</p>
<p>
This will yield the hostname, username, and a hash of connection options to
the given block, which should return a new connection.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001603-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001603-source">
<pre>
    <span class="ruby-comment cmt"># File lib/capistrano/ssh.rb, line 54</span>
54:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connection_strategy</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">options</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
55:       <span class="ruby-identifier">methods</span> = [ <span class="ruby-node">%w(publickey hostbased)</span>, <span class="ruby-node">%w(password keyboard-interactive)</span> ]
56:       <span class="ruby-identifier">password_value</span> = <span class="ruby-keyword kw">nil</span>
57: 
58:       <span class="ruby-identifier">ssh_options</span> = (<span class="ruby-identifier">server</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:ssh_options</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:ssh_options</span>] <span class="ruby-operator">||</span> {})
59:       <span class="ruby-identifier">user</span>        = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">user</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">ssh_options</span>[<span class="ruby-identifier">:username</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ServerDefinition</span>.<span class="ruby-identifier">default_user</span>
60:       <span class="ruby-identifier">port</span>        = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">port</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:port</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">ssh_options</span>[<span class="ruby-identifier">:port</span>]
61: 
62:       <span class="ruby-identifier">ssh_options</span>[<span class="ruby-identifier">:port</span>] = <span class="ruby-identifier">port</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span>
63:       <span class="ruby-identifier">ssh_options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:username</span>)
64: 
65:       <span class="ruby-keyword kw">begin</span>
66:         <span class="ruby-identifier">connection_options</span> = <span class="ruby-identifier">ssh_options</span>.<span class="ruby-identifier">merge</span>(
67:           <span class="ruby-identifier">:password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">password_value</span>,
68:           <span class="ruby-identifier">:auth_methods</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssh_options</span>[<span class="ruby-identifier">:auth_methods</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">shift</span>
69:         )
70: 
71:         <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">connection_options</span>
72:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">AuthenticationFailed</span>
73:         <span class="ruby-identifier">raise</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ssh_options</span>[<span class="ruby-identifier">:auth_methods</span>]
74:         <span class="ruby-identifier">password_value</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:password</span>]
75:         <span class="ruby-keyword kw">retry</span>
76:       <span class="ruby-keyword kw">end</span>
77:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001605" class="method-detail">
        <a name="M001605"></a>

        <div class="method-heading">
          <a href="#M001605" class="method-signature">
          <span class="method-name">connection_strategy</span><span class="method-args">(server, options={}) {|server.host, user, connection_options| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Abstracts the logic for establishing an <a href="SSH.html">SSH</a>
connection (which includes testing for connection failures and retrying
with a password, and so forth, mostly made complicated because of the fact
that some of these variables might be lazily evaluated and try to do
something like prompt the user, which should only happen when absolutely
necessary.
</p>
<p>
This will yield the hostname, username, and a hash of connection options to
the given block, which should return a new connection.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001605-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001605-source">
<pre>
    <span class="ruby-comment cmt"># File lib/capistrano/ssh.rb, line 54</span>
54:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">connection_strategy</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">options</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
55:       <span class="ruby-identifier">methods</span> = [ <span class="ruby-node">%w(publickey hostbased)</span>, <span class="ruby-node">%w(password keyboard-interactive)</span> ]
56:       <span class="ruby-identifier">password_value</span> = <span class="ruby-keyword kw">nil</span>
57: 
58:       <span class="ruby-identifier">ssh_options</span> = (<span class="ruby-identifier">server</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:ssh_options</span>] <span class="ruby-operator">||</span> {}).<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:ssh_options</span>] <span class="ruby-operator">||</span> {})
59:       <span class="ruby-identifier">user</span>        = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">user</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:user</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">ssh_options</span>[<span class="ruby-identifier">:username</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ServerDefinition</span>.<span class="ruby-identifier">default_user</span>
60:       <span class="ruby-identifier">port</span>        = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">port</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:port</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">ssh_options</span>[<span class="ruby-identifier">:port</span>]
61: 
62:       <span class="ruby-identifier">ssh_options</span>[<span class="ruby-identifier">:port</span>] = <span class="ruby-identifier">port</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span>
63:       <span class="ruby-identifier">ssh_options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:username</span>)
64: 
65:       <span class="ruby-keyword kw">begin</span>
66:         <span class="ruby-identifier">connection_options</span> = <span class="ruby-identifier">ssh_options</span>.<span class="ruby-identifier">merge</span>(
67:           <span class="ruby-identifier">:password</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">password_value</span>,
68:           <span class="ruby-identifier">:auth_methods</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ssh_options</span>[<span class="ruby-identifier">:auth_methods</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">shift</span>
69:         )
70: 
71:         <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">connection_options</span>
72:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">AuthenticationFailed</span>
73:         <span class="ruby-identifier">raise</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ssh_options</span>[<span class="ruby-identifier">:auth_methods</span>]
74:         <span class="ruby-identifier">password_value</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:password</span>]
75:         <span class="ruby-keyword kw">retry</span>
76:       <span class="ruby-keyword kw">end</span>
77:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>